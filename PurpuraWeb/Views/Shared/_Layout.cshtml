@using Microsoft.AspNetCore.Identity
@inject UserManager<IdentityUser> UserManager;
@inject SignInManager<IdentityUser> SignInManager

@{
    var path = ViewContext.RouteData.Values["page"] as string;

    var authenticationPaths = new List<string>
    {
        "/Account/Login",
        "/Account/Register",
        "/Account/Logout"
    };

    var companyDetailsHref = "/company/details";
    var companyReferenceClaim = User.FindFirst("CompanyReference")?.Value;
                                              
    if(companyReferenceClaim != null)
    {
        companyDetailsHref += $"?companyReference={companyReferenceClaim}";
    }
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Purpura HR</title>

    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/UserAuthentication.css" />
    <link rel="stylesheet" href="~/css/UserManagement.css" />
    <link rel="stylesheet" href="~/css/AnnualLeave.css" />
    <link rel="stylesheet" href="~/css/Goals.css" />
    <link rel="stylesheet" href="~/css/Companies.css" />
    <link rel="stylesheet" href="~/css/Dashboard.css" />
    <link rel="stylesheet" href="~/PurpuraWeb.styles.css" asp-append-version="true" />

    <!--javascript packages-->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
</head>
<body style="@(authenticationPaths.Contains(path) ? "background: linear-gradient(white, mediumpurple);" : "")">

    @if (!authenticationPaths.Contains(path))
    {
        <header>
            <h4><strong>Purpura HR</strong></h4>
            @if (SignInManager.IsSignedIn(User))
            {
                var loggedInAsString = $"Logged in as {User.FindFirst("Name")?.Value}";

                <div id="header-profile-container">
                    <form class="form-inline" asp-area="Identity" asp-page="/Account/Logout">
                        <button id="logout" type="submit" class="nav-link btn btn-link text-white">Logout</button>
                    </form>
                    <i data-bs-toggle="tooltip" data-bs-title="@loggedInAsString" class="bi bi-person-circle"></i>
                </div>
            }
        </header>
    }

    <div id="page-container">

        @if (!authenticationPaths.Contains(path))
        {
            <nav id="side-nav">
                <hr/>
                @if (Context.Request.Path != "/Home/Dashboard")
                {
                    <a class="navigation-links" href="/home/dashboard">
                        <i class="bi bi-stack"></i>
                        <span>Dashboard</span>
                    </a>
                }
                <a class="navigation-links" href="@($"/usermanagement/details/{UserManager.GetUserId(User)}")">
                    <i class="bi bi-person-fill-gear"></i>
                    <span>Account Details</span>
                </a>
                <a class="navigation-links" href="/annualleave/index">
                    <i class="bi bi-calendar-check-fill"></i>
                    <span>Book Time Off</span>
                </a>
                <a class="navigation-links" href="/goal/index">
                    <i class="bi bi-trophy-fill"></i>
                    <span>Goals</span>
                </a>
                <a class="navigation-links" href="@companyDetailsHref">
                    <i class="bi bi-building-fill"></i>
                    <span>Company Details</span>
                </a>
            </nav>

            <div id="header-buffer"></div>

            <div id="button-container">
                <button class="btn" type="button" id="mobile-menu-toggle" data-bs-toggle="offcanvas" data-bs-target="#offcanvas-nav" >
                    <i class="bi bi-list h1"></i>
                </button>
            </div>

            <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvas-nav" aria-labelledby="offcanvasExampleLabel">

                <div class="offcanvas-header">
                    <button type="button" class="btn-close btn-close-white text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>

                <div class="offcanvas-body">
                    <nav id="mobile-nav">
                        @if (Context.Request.Path != "/Home/Dashboard")
                        {
                            <a class="navigation-links" href="/home/dashboard">
                                <i class="bi bi-stack"></i>
                                <span>Dashboard</span>
                            </a>
                        }
                        <a class="navigation-links" href="@($"/usermanagement/details/{UserManager.GetUserId(User)}")">
                            <i class="bi bi-person-fill-gear"></i>
                            <span>Account Details</span>
                        </a>
                        <a class="navigation-links" href="/annualleave/index">
                            <i class="bi bi-calendar-check-fill"></i>
                            <span>Book Time Off</span>
                        </a>
                        <a class="navigation-links" href="/goal/index">
                            <i class="bi bi-trophy-fill"></i>
                            <span>Goals</span>
                        </a>
                        <a class="navigation-links" href="@companyDetailsHref">
                            <i class="bi bi-building-fill"></i>
                            <span>Company Details</span>
                        </a>
                    </nav>
                </div>
            </div>
        }

        <div @(authenticationPaths.Contains(path) ? "" : "id=main-content-container")>
            <main role="main">
                @RenderBody()
            </main>
        </div>

    </div>

    @if (!authenticationPaths.Contains(path))
    {
        <footer class="border-top footer text-black">
            <span id="footer-name">Created by Ross Kennedy</span>
            <div id="footer-flex-container" >
                <a href="https://github.com/RoKen1000/PurpuraHR">View the repo for this project here</a>
                <a href="https://ross-kennedy-dev.netlify.app/">View my portfolio website here</a>
            </div>
        </footer>
    }

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    <script src="~/js/AnnualLeave.js" ></script>
    <script src="~/js/Goals.js"></script>
    <script src="~/js/CompanyEmployee.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>